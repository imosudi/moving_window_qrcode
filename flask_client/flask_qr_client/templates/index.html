<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instructor QR Code</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    
    <!-- JavaScript for Auto-Formatting -->
    <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</head>
<body class="bg-light">
    <div class="container d-flex justify-content-center align-items-center vh-100">
        <div class="card shadow p-4 text-center">
            <h4 class="mb-3 text-primary">QR Code for <span id="courseCode">{{ course_code }}</span></h4>
            <p class="text-secondary">Instructor ID: <strong id="instructorId">{{ instructor_id }}</strong></p>

            <p><strong>QR Code Payload:</strong> <span id="qrPayload" class="text-monospace">{{ qr_code_payload }}</span></p>

            <p class="text-danger fw-bold">Expires at: <span id="expiryTime" data-timestamp="{{ expiry_time }}">{{ expiry_time }}</span></p>

            <img id="qrCodeImage" class="border rounded mb-3" 
                 src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data={{ qr_code_payload }}" 
                 alt="QR Code">

            <button class="btn btn-success" onclick="reloadQRCode()">Reload QR Code</button>
        </div>
    </div>

    <!-- JavaScript for Formatting Expiry Time -->
    <script>
        function formatTimestamp(timestamp) {
            if (!timestamp) return "N/A";  // Handle missing timestamp case
            const date = new Date(timestamp * 1000);
            return date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
        }

        document.addEventListener("DOMContentLoaded", function () {
            const expirySpan = document.getElementById("expiryTime");
            const expiryTimestamp = parseInt(expirySpan.getAttribute("data-timestamp"), 10);
            expirySpan.textContent = formatTimestamp(expiryTimestamp);
        });

        function reloadQRCode() {
            location.reload(); // Simple way to refresh the page
        }
    </script>
</body>
</html>
